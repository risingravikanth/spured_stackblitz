<div class="container marTop45">
    <br class="d-block d-sm-none">
    <br>
    <div class="row">
        <div class="col-md-3 col-sm-3" *ngIf="!isMobile">
            <side-menu></side-menu>
        </div>
        <div [class]="!isMobile ? 'col-md-6' : 'col-md-10'">
            <div class="card question-back" *ngIf="validUser && !paramId">
                <div class="row" style="padding-left: 28px;">
                    <div style="width: 20%;">
                        <img width="80" height="80" style=" padding: 5px;border-radius: 50px;" alt="ProfilePic" [src]="profileImage">
                    </div>
                    <hr>
                    <div style="width: 80%;">
                        <h3 class="question-text">
                            <a class="addQuestion" href="javascript:void(0);" data-toggle="modal" (click)="postQuestionDialog(postDialog)"
                                *ngIf="questionName?.length == 0">Add your question</a>
                            <a class="addQuestion" href="javascript:void(0);" data-toggle="modal" (click)="postQuestionDialog(postDialog)"
                                *ngIf="questionName?.length > 0">Add your question on {{questionName | titlecase}}
                            </a>
                        </h3>
                    </div>
                </div>
            </div>
            <br>
            <div *ngFor="let post of postsList;index as i;">
                <div class="card">
                    <div class="d-flex justify-content-between">
                        <div>
                            <span style="font-size: 12px;padding-left: 10px;margin-top: 8px;">
                                <a *ngIf="post._type != 'BoardPost'" style="color: gray" href="javascript:void(0);" (click)="goToCategoriesPage(post._type, null)">{{getSectionFromType(post._type)
                                    | titlecase}} </a>
                                <span *ngIf="post.category"> / <a style="color: gray" href="javascript:void(0);"
                                        (click)="goToCategoriesPage(post._type, post.category)">{{
                                        getCategoryFromModel(post._type, post.category) |
                                        titlecase}}</a></span>
                                <span *ngIf="post.model" style="color: gray"> / {{post.model | titlecase}}</span></span>
                        </div>
                        <div style="padding: 3px 7px 0px 0px;">
                            <i class="fas fa-ellipsis-h" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true"
                                aria-expanded="false" style="font-size: 20px;"></i>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                                <button class="dropdown-item" type="button" *ngIf="post.userProfile && currentuserId == post.userProfile.userId"
                                    (click)="editPost(post.postId, post._type, editPostDialog)">Edit</button>
                                <button class="dropdown-item" type="button" *ngIf="post.userProfile && currentuserId == post.userProfile.userId"
                                    (click)="deletePost(post.postId, post._type)">Delete</button>
                                <button class="dropdown-item" type="button">Report</button>
                            </div>
                        </div>
                    </div>
                    <hr style="margin-top: -3px;">
                    <div class="row" style="padding-left: 9px;margin-top: -15px;">
                        <div>
                            <img width="80" height="80" style="padding: 18px;border-radius: 50px;margin-top: -7px;" alt="UserProfilePic"
                                [src]="(post.userProfile && post.userProfile.profileImageUrl) ? serverUrl + post.userProfile.profileImageUrl : assets/images/noticer_default_user_img.png">
                        </div>
                        <div style="margin-left: -48px;margin-top: 12px;">
                            <ul>
                                <li>
                                    <a href="javascript:void(0);" *ngIf="post.userProfile" (click)="redirectToOtherProfile(post.userProfile.userId)"
                                        style="color: black;font-weight: 400;">
                                        {{post.userProfile ? post.userProfile.userName : '-NA-'}}
                                    </a>
                                    <a href="javascript:void(0);" *ngIf="!post.userProfile" style="color: black;font-weight: 400;">
                                        {{post.userProfile ? post.userProfile.userName : '-NA-'}}
                                    </a>
                                </li>
                                <li class="text-muted" style="font-size: 12px;">{{post.createTime | date: 'MMM d, y,
                                    h:mm:ss a'}}</li>
                            </ul>
                        </div>
                    </div>
                    <div style="margin-left: 17px;">
                        <div *ngIf="post._type == 'CareerPost'">
                            <div *ngIf="post.deadline">
                                Deadline: {{post.deadline}}
                            </div>
                        </div>
                    </div>
                    <div>
                        <div *ngIf="post._type == 'EventsPost'">
                            <table>
                                <tr>
                                    <td>
                                        {{post.topic}}
                                    </td>
                                    <td *ngIf="post.fromdate && post.todate">
                                        <i class="fas fa-calendar-alt"></i>
                                        {{post.fromdate}} to {{post.todate}}
                                    </td>
                                </tr>
                                <!-- <tr>
                                    <td *ngIf="post.website">
                                        <a href="www.google.com">{{post.website}}</a>
                                    </td>
                                    <td *ngIf="post.contacts">
                                        <i class="fas fa-phone-square"></i> {{post.contacts}}</td>
                                </tr> -->
                            </table>
                            <br>
                        </div>
                        <div class="post-text">
                            <h6><b><a *ngIf="!paramId" (click)="navigateToPostDetails(post)" style="color:black" href="javascript:void(0);">
                                        {{post.postTitle ? post.postTitle : '-NA-'}}</a>
                                    <span *ngIf="paramId">{{post.postTitle ? post.postTitle : '-NA-'}}</span></b></h6>
                        </div>
                        <div class="post-text">
                            <!-- [innerHTML] -->
                            <p>
                                <a *ngIf="!paramId" style="color: black;">
                                    <label class="multiLineText">{{post.postText | slice:0:post.maxLength}}</label>
                                    <label *ngIf="post.postText.length > post.maxLength">...</label>
                                </a>
                                <a style="font-size: 12px;padding: 2px;color:gray;" *ngIf="!paramId && post.postText.length > post.maxLength"
                                    (click)="post.maxLength = post.postText.length" href="javascript:void(0);">see
                                    more</a>
                                <a *ngIf="paramId" style="color: black;">
                                    <label class="multiLineText">{{post.postText}}</label>
                                </a>
                            </p>
                        </div>
                    </div>
                    <div style="margin-top: -23px;">
                        <div *ngIf="post.images.length == 1">
                            <a [attr.data-lightbox]="post._type+post.postId" data-title="Post Images" href="{{serverUrl}}/{{post.images[0]}}">
                                <img src="{{serverUrl}}/{{post.images[0]}}" style="max-width: 100%; max-height: 100%;padding: 7px;">
                            </a>
                        </div>

                        <div class="images" *ngIf="post.images.length == 2" style="padding:7px;">
                            <mat-grid-list cols="2" rowHeight="2:1">
                                <mat-grid-tile *ngFor="let tile of post.images">
                                    <a [attr.data-lightbox]="post._type+post.postId" data-title="Post Images" href="{{serverUrl}}/{{tile}}">
                                        <img style="max-width: 100%; max-height: 100%;" src="{{serverUrl}}/{{tile}}">
                                    </a>
                                </mat-grid-tile>
                            </mat-grid-list>
                        </div>
                        <div class="images" *ngIf="post.images.length == 3" style="padding:7px;">
                            <mat-grid-list cols="3" rowHeight="2:2">
                                <mat-grid-tile *ngFor="let tile of post.images">
                                    <a [attr.data-lightbox]="post._type+post.postId" data-title="Post Images" href="{{serverUrl}}/{{tile}}">
                                        <img style="max-width: 100%; max-height: 100%;" src="{{serverUrl}}/{{tile}}">
                                    </a>
                                </mat-grid-tile>
                            </mat-grid-list>
                        </div>

                        <div class="images" *ngIf="post.images.length == 4" style="padding-right: 7px;">
                            <mat-grid-list cols="2" rowHeight="2:1">
                                <mat-grid-tile *ngFor="let tile of post.images">
                                    <a [attr.data-lightbox]="post._type+post.postId" data-title="Post Images" href="{{serverUrl}}/{{tile}}">
                                        <img style="max-width: 100%; max-height: 100%;" src="{{serverUrl}}/{{tile}}">
                                    </a>
                                </mat-grid-tile>
                            </mat-grid-list>
                        </div>
                    </div>
                    <hr>
                    <div style="margin-top: -8px;margin-bottom: -10px;">
                        <ul class="list-inline">
                            <li class="list-inline-item paddingIcons" style="cursor: pointer;" (click)="getCommentsForPost(post.postId,i);">
                                <i class="fas fa-comments iconSize"></i>&nbsp;
                                <a>
                                    {{post.commentsCount}} Comments
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div *ngIf="post.selectComments">
                        <hr style="margin-top: -5px;">
                        <div style="padding-left: 7px;padding-right: 7px;padding-bottom: 7px;" *ngIf="validUser">
                            <form>
                                <div class="input-group">
                                    <div class="input-group-btn">
                                        <button class="btn btn-default" style="border-radius: 17px;" (click)="createComment(post.commentText, i)"
                                            [disabled]="post.commentText == null || post.commentText?.length == 0">
                                            <i class="fas fa-share-square"></i>
                                        </button>
                                    </div>
                                    <textarea rows="1" type="text" class="form-control" style="border-radius: 17px;"
                                        [ngModelOptions]="{standalone: true}" [(ngModel)]="post.commentText"
                                        placeholder="Add a comment.."></textarea>
                                </div>
                            </form>
                        </div>
                        <div *ngFor="let comment of post.comments;index as in">
                            <div class="wrap" style="margin-top: -6px;">
                                <div class="commentProfile">
                                    <img width="80" height="80" style="padding: 18px;border-radius: 50px;" alt="ProfilePic"
                                        [src]="(comment.userProfile && comment.userProfile.profileImageUrl) ? (serverUrl + comment.userProfile.profileImageUrl) : assets/images/noticer_default_user_img.png">
                                </div>
                                <div class="commentBody">
                                    <ul>
                                        <li>
                                            <a style="font-size: 11px;color: black;font-weight: 500;" (click)="redirectToOtherProfile(comment.userProfile.userId)"
                                                href="javascript:void(0);">
                                                {{comment.userProfile.userName}}
                                            </a>
                                        </li>
                                        <li style="font-size: 10px;">{{comment.createTime | date: 'MMM d, y, h:mm:ss
                                            a'}}</li>
                                        <li style="font-size: 13px;">
                                            <!-- <p>{{comment.commentText}}</p> -->
                                            <!-- <label [innerHtml]="comment.commentText | slice:0:comment.maxLength"></label> -->
                                            <label class="multiLineText">{{comment.commentText |
                                                slice:0:comment.maxLength}}</label>
                                            <label *ngIf="comment.commentText.length > comment.maxLength">...</label>
                                            <a style="font-size: 12px;padding: 2px;color:gray;" *ngIf="comment.commentText.length > comment.maxLength"
                                                (click)="comment.maxLength = comment.commentText.length" href="javascript:void(0);">see
                                                more</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div style="margin-left: 50%;" *ngIf="post.commentsSpinner">
                            <div class="loader"></div>
                        </div>
                        <div class="text-center" *ngIf="showMoreCommentsChecker(post.comments, post.commentsCount) && !post.commentsSpinner">
                            <a href="javascript:void(0);" (click)="loadMoreComments(post.postId,i)"> load old comments
                            </a>
                        </div>
                    </div>
                </div>
                <br>
            </div>
            <div style="margin-left: 50%;" *ngIf="showPostSpinner">
                <div class="loader"></div>
            </div>
            <div class="text-center" *ngIf="!showPostSpinner">
                <a *ngIf="postsList.length > 0 && showMoreLink && !paramId" href="javascript:void(0);" (click)="loadMorePosts()">
                    Show more </a>
                <b *ngIf="noData">Opps! No Posts Available</b>
            </div>
        </div>
        <div class="col-md-3" *ngIf="!isMobile">
            <right-menu></right-menu>
        </div>
    </div>
    <div (click)="goToTop()" class="btt-btn"><i class="fas fa-chevron-up"></i></div>
</div>





<!-- Create post dialog code -->
<section>
    <ng-template #postDialog let-c="close" let-d="dismiss">
        <div class="modal-header">
            <h5 class="modal-title" id="modal-basic-title">
                <b>Add Question</b>
            </h5>
            <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <form [formGroup]="addPostForm">
            <div class="modal-body" formGroupName="data">
                <div class="form-group" style="padding:12px;">
                    <textarea class="form-control" rows="1" maxlength="300" formControlName="title" placeholder="Question title(max 300Chars)"></textarea>
                </div>
                <div class="form-group" style="padding: 1px 12px 1px 12px;">
                    <textarea class="form-control" rows="4" formControlName="postText" placeholder="Question description"></textarea>
                </div>
                <!-- post start -->
                <div class="addPost" *ngIf="reqestType != 'BOARD'">
                    <div class="row">
                        <div class="form-group col-md-4">
                            <p-dropdown placeholder=" Type" [options]="types" (onChange)="getCategoriesByType(_type.value)"
                                [style]="{'width':'100%'}" formControlName="_type1" filter="true" #_type>
                                <ng-template let-type pTemplate="item">
                                    <div class="ui-helper-clearfix" [style]="{'width':'100%'}">
                                        <span style="vertical-align:middle">{{type.label}}</span>
                                    </div>
                                </ng-template>
                            </p-dropdown>
                        </div>
                        <div class="form-group col-md-4">
                            <p-dropdown placeholder=" Category" [options]="categories" [style]="{'width':'100%'}"
                                formControlName="category" filter="true">
                                <ng-template let-category pTemplate="item">
                                    <div class="ui-helper-clearfix" [style]="{'width':'100%'}">
                                        <span style="vertical-align:middle">{{category.label}}</span>
                                    </div>
                                </ng-template>
                            </p-dropdown>
                        </div>
                        <div class="form-group col-md-4" *ngIf="addPostForm.controls['data'].get('_type1').value == 'EVENTS' || 
                        addPostForm.controls['data'].get('_type1').value == 'CAREERS' ||
                        addPostForm.controls['data'].get('_type1').value == 'VERBAL' ||
                        addPostForm.controls['data'].get('_type1').value == 'QUANTS' ||
                        addPostForm.controls['data'].get('_type1').value == 'DI' ||
                        addPostForm.controls['data'].get('_type1').value == 'CURRENT_AFFAIRS'">
                            <p-dropdown placeholder=" Model" [options]="models" [style]="{'width':'100%'}"
                                formControlName="model" filter="true">
                                <ng-template let-model pTemplate="item">
                                    <div class="ui-helper-clearfix" [style]="{'width':'100%'}">
                                        <span style="vertical-align:middle">{{model.label}}</span>
                                    </div>
                                </ng-template>
                            </p-dropdown>
                        </div>
                    </div>

                    <!-- events -->
                    <div class="row" *ngIf="addPostForm.controls['data'].get('_type1').value == 'EVENTS'">
                        <div class="form-group col-md-6">
                            <p-calendar [showIcon]="true" dateFormat="yy-mm-dd" formControlName="fromDate" placeholder="From Date"
                                [style]="{'width':'95%'}" [inputStyle]="{'width':'95%'}"></p-calendar>
                        </div>
                        <div class="form-group col-md-6">
                            <p-calendar [showIcon]="true" dateFormat="yy-mm-dd" formControlName="toDate" placeholder="To Date"
                                [style]="{'width':'95%'}" [inputStyle]="{'width':'95%'}"></p-calendar>
                        </div>

                    </div>
                    <div class="row" *ngIf="addPostForm.controls['data'].get('_type1').value == 'EVENTS'">
                        <div class="form-group col-md-6">
                            <input class="form-control form-control-sm" type="text" formControlName="topic" placeholder="Topic">
                        </div>
                        <!-- <div class="form-group col-md-6">
                            <input class="form-control form-control-sm" type="text" formControlName="contacts"
                                placeholder="Contacts">
                        </div> -->
                    </div>
                    <!-- events end -->

                    <!-- careers -->
                    <div class="col-md-4" *ngIf="addPostForm.controls['data'].get('_type1').value == 'CAREERS'">
                        <p-calendar [showIcon]="true" dateFormat="yy-mm-dd" formControlName="deadline" placeholder="Deadline"
                            [style]="{'width':'95%'}" [inputStyle]="{'width':'95%'}"></p-calendar>
                    </div>
                    <!-- careers end -->
                </div>
                <!-- post end -->

                <!-- Images list start-->
                <div class="addPost">
                    <div style="padding-left: 50px;padding-right: 3px;">
                        <span *ngFor="let url of urls;index as in;">
                            <figure>
                                <img [src]="url" class="rounded mb-3" style="margin-left: 10px;" width="150" height="150">
                                <figcaption><a href="javascript:void(0);" (click)="removeFromImages(in)">Remove</a></figcaption>
                            </figure>
                        </span>
                    </div>
                </div>
                <!-- Images list end-->
            </div>
            <!-- model end-->

            <ul class="list-inline postIcons">
                <span class="btn btn-light btn-file">
                    <i class="fas fa-camera"></i> Browse photos
                    <input type="file" accept="image/gif, image/jpeg, image/jpg, image/png" multiple (change)="detectFiles($event)">
                </span>
            </ul>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" [disabled]="addPostForm.invalid" (click)="createPost()">Post</button>
            </div>
        </form>
    </ng-template>
</section>
<section>
    <!-- Create post dialog code -->
    <section>
        <ng-template #editPostDialog let-c="close" let-d="dismiss">
            <div class="modal-header">
                <h5 class="modal-title" id="modal-basic-title">
                    <b>Edit Post</b>
                </h5>
                <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form [formGroup]="editPostForm">
                <div formGroupName="data">
                    <div class="modal-body">
                        <div class="form-group" style="padding:12px;">
                            <textarea class="form-control" rows="1" maxlength="300" formControlName="title" placeholder="Question title(max 300Chars)"></textarea>
                        </div>
                        <div class="form-group" style="padding: 1px 12px 1px 12px;">
                            <textarea class="form-control" formControlName="text" rows="10" placeholder="What is your question?"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" [disabled]="editPostForm.invalid" (click)="saveEditPost()">Update</button>
                    </div>
                </div>
            </form>
        </ng-template>

    </section>
    <section>
        <p-confirmDialog header="Confirmation" icon="pi pi-exclamation-triangle" width="23%"></p-confirmDialog>
    </section>